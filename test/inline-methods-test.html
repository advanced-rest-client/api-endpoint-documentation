<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
  <title>api-endpoint-documentation test</title>

  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../../../@polymer/test-fixture/test-fixture.js"></script>
  <script src="../../../mocha/mocha.js"></script>
  <script src="../../../chai/chai.js"></script>
  <script src="../../../wct-mocha/wct-mocha.js"></script>

  <script src="./amf-loader.js"></script>

  <script src="../../../jsonlint/lib/jsonlint.js"></script>
  <script src="../../../codemirror/lib/codemirror.js"></script>
  <script src="../../../codemirror/addon/mode/loadmode.js"></script>
  <script src="../../../codemirror/mode/meta.js"></script>
  <script src="../../../codemirror/mode/javascript/javascript.js"></script>
  <script src="../../../codemirror/mode/xml/xml.js"></script>
  <script src="../../../codemirror/mode/htmlmixed/htmlmixed.js"></script>
  <script src="../../../codemirror/addon/lint/lint.js"></script>
  <script src="../../../codemirror/addon/lint/json-lint.js"></script>
  <script src="../../../@advanced-rest-client/code-mirror-hint/headers-addon.js"></script>
  <script src="../../../@advanced-rest-client/code-mirror-hint/show-hint.js"></script>
  <script src="../../../@advanced-rest-client/code-mirror-hint/hint-http-headers.js"></script>
  <script>
  /* global CodeMirror */
  CodeMirror.modeURL = '../../../codemirror/mode/%N/%N.js';
  </script>
  <script src="../../../cryptojslib/components/core.js"></script>
  <script src="../../../cryptojslib/rollups/sha1.js"></script>
  <script src="../../../cryptojslib/components/enc-base64-min.js"></script>
  <script src="../../../cryptojslib/rollups/md5.js"></script>
  <script src="../../../cryptojslib/rollups/hmac-sha1.js"></script>
  <script src="../../../jsrsasign/lib/jsrsasign-rsa-min.js"></script>
</head>
<body>
  <test-fixture id="Basic">
    <template>
      <api-endpoint-documentation inline-methods></api-endpoint-documentation>
    </template>
  </test-fixture>
  <script type="module">
  import '../api-endpoint-documentation.js';
  /* global AmfLoader */
  function getEndpoint(element, amf, endpoint) {
    const webApi = element._computeWebApi(amf);
    return element._computeEndpointByPath(webApi, endpoint);
  }

  // function getMethod(element, amf, endpoint, method) {
  //   const endPoint = getEndpoint(element, amf, endpoint);
  //   const opKey = element._getAmfKey(element.ns.w3.hydra.supportedOperation);
  //   const ops = element._ensureArray(endPoint[opKey]);
  //   return ops.find((item) => element._getValue(item, element.ns.w3.hydra.core + 'method') === method);
  // }

  suite('Full AMF model', () => {
    [
      ['Full model', false],
      ['Compact model', true]
    ]
    .forEach((item) => {
      suite(item[0], () => {
        let element;
        let amf;
        suiteSetup(() => {
          return AmfLoader.load(0, item[1])
          .then((data) => {
            amf = data[0];
          });
        });

        setup((done) => {
          element = fixture('Basic');
          element.amfModel = amf;
          element.endpoint = getEndpoint(element, amf, '/people/{personId}');
          flush(() => {
            // Becaus of async panels redering it has to wait a bit longer
            // otherwise slower browsers like Edge or Safari will not render
            // the content on time.
            setTimeout(() => {
              done();
            });
          });
        });

        test('Renders 3 methods containers', () => {
          const nodes = element.shadowRoot.querySelectorAll('.method-container');
          assert.lengthOf(nodes, 3);
        });
        // (Pawel): Note, methods docs rendering is async. This won't check for every
        // method rendering as the time of element rendering is unknown.
        // There's an (fair) assumption that is one panel is redered then other
        // are rendered as well.
        test('Renders method documentations', () => {
          const node = element.shadowRoot.querySelector('api-method-documentation');
          assert.ok(node);
        });

        test('Renders tryit panels', () => {
          const node = element.shadowRoot.querySelector('api-request-panel');
          assert.ok(node);
        });

        test('Renders code snippets', () => {
          const node = element.shadowRoot.querySelector('api-request-panel');
          assert.ok(node);
        });
      });
    });
  });
  </script>
</body>
</html>
